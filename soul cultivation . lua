-- Soul Cultivation Farm v1.0 – Rayfield GUI Full + Multi Select + Super Fast Tween & Attack
-- Detect dari workspace.Enemies, pisah regular & boss, tween anti kepental, anti-kick agresif

local Rayfield = loadstring(game:HttpGet('https://sirius.menu/rayfield'))()

local Window = Rayfield:CreateWindow({
   Name = "Soul Cultivation Farm",
   LoadingTitle = "Loading Farm Script...",
   LoadingSubtitle = "by Grok",
   ConfigurationSaving = {
      Enabled = true,
      FolderName = "SoulCultivationFarm",
      FileName = "Config"
   },
   KeySystem = false
})

local FarmTab = Window:CreateTab("Farm Controls", 4483362458)
local MobTab = Window:CreateTab("Regular Mobs", 4483362458)
local BossTab = Window:CreateTab("Boss Mobs", 4483362458)
local SettingsTab = Window:CreateTab("Settings", 4483362458)

-- Variables
local farming = false
local noclipEnabled = false
local attackCount = 0
local lastAfkAction = tick()

local tweenSpeed = 500          -- Super cepat untuk switch mob
local aboveDistance = 4         -- Jarak di atas mob
local attackRange = 15
local attackDelay = 0.01        -- Tercepat mungkin
local refreshInterval = 0.2     -- Scan sangat cepat

local selectedRegularMobs = {}  -- Multi select mob biasa
local selectedZangshiRen = false
local selectedZangshiBing = false

-- Services
local Players = game:GetService("Players")
local TweenService = game:GetService("TweenService")
local RunService = game:GetService("RunService")
local VirtualUser = game:GetService("VirtualUser")
local VirtualInputManager = game:GetService("VirtualInputManager")
local ReplicatedStorage = game:GetService("ReplicatedStorage")

local player = Players.LocalPlayer

-- Remote Attack
local RemoteAttack = ReplicatedStorage:WaitForChild("RemoteEvents"):WaitForChild("Attack")

-- Enemies folder
local EnemiesFolder = workspace:WaitForChild("Enemies")

-- Scan enemies
local validEnemies = {}
local function scanEnemies()
   validEnemies = {}
   for _, v in pairs(EnemiesFolder:GetChildren()) do
      if v:IsA("Model") and v:FindFirstChild("HumanoidRootPart") and v:FindFirstChildWhichIsA("Humanoid") and v.Humanoid.Health > 0 then
         table.insert(validEnemies, v)
      end
   end
end

-- Get HRP
local function getHRP()
   local char = player.Character
   if char then return char:FindFirstChild("HumanoidRootPart") end
end

-- Tween super cepat & stabil (anti kepental setelah kill)
local function tweenToPosition(targetPos)
   local hrp = getHRP()
   if not hrp then return end
   
   local distance = (hrp.Position - targetPos).Magnitude
   if distance < 8 then return end
   
   local time = distance / tweenSpeed
   local tweenInfo = TweenInfo.new(math.max(time, 0.06), Enum.EasingStyle.Linear)
   
   pcall(function()
      local tween = TweenService:Create(hrp, tweenInfo, {CFrame = CFrame.new(targetPos)})
      tween:Play()
      tween.Completed:Wait()
   end)
   
   -- Fallback langsung kalau tween gagal
   pcall(function()
      hrp.CFrame = CFrame.new(targetPos)
   end)
end

-- Noclip
local function setNoclip(state)
   local char = player.Character
   if char then
      for _, part in pairs(char:GetDescendants()) do
         if part:IsA("BasePart") then
            part.CanCollide = not state
         end
      end
   end
end

-- Anti-kick super agresif
local function doAntiKickAction()
   if not farming then return end
   local hrp = getHRP()
   if not hrp then return end
   
   hrp.AssemblyLinearVelocity = Vector3.new(math.random(-1,1)*12, 0, math.random(-1,1)*12)
   
   pcall(function()
      VirtualUser:Button2Down(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
      wait(0.05)
      VirtualUser:Button2Up(Vector2.new(0,0), workspace.CurrentCamera.CFrame)
   end)
   
   pcall(function()
      VirtualUser:MoveMouseTo(Vector2.new(math.random(200, 1000), math.random(200, 800)))
      wait(0.1)
      VirtualUser:MoveMouseTo(Vector2.new(math.random(200, 1000), math.random(200, 800)))
   end)
   
   local keys = {Enum.KeyCode.W, Enum.KeyCode.A, Enum.KeyCode.S, Enum.KeyCode.D, Enum.KeyCode.Space, Enum.KeyCode.LeftShift}
   local randomKey = keys[math.random(1, #keys)]
   pcall(function()
      VirtualInputManager:SendKeyEvent(true, randomKey, false, game)
      wait(0.05)
      VirtualInputManager:SendKeyEvent(false, randomKey, false, game)
   end)
   
   print("Anti-Kick: Action dilakukan")
end

-- Farm logic utama
local function startFarm()
   farming = true
   attackCount = 0
   
   spawn(function()
      local lastScan = tick()
      while farming do
         if tick() - lastScan > refreshInterval then
            scanEnemies()
            lastScan = tick()
         end
         
         -- Anti-kick
         if tick() - lastAfkAction > math.random(120, 180) then
            doAntiKickAction()
            lastAfkAction = tick()
         end
         
         local target = nil
         for _, enemy in ipairs(validEnemies) do
            local name = enemy.Name
            if selectedRegularMobs[name] or (name == "Zangshi Hou Ren" and selectedZangshiRen) or (name == "Zangshi Hou Bing" and selectedZangshiBing) then
               local ehrp = enemy:FindFirstChild("HumanoidRootPart")
               if ehrp and enemy:FindFirstChildWhichIsA("Humanoid").Health > 0 then
                  target = enemy
                  break
               end
            end
         end
         
         if not target then
            wait(0.1)
            continue
         end
         
         local ehrp = target:FindFirstChild("HumanoidRootPart")
         local hrp = getHRP()
         if not ehrp or not hrp then continue end
         
         -- Tween cepat ke posisi atas mob
         local basePos = Vector3.new(ehrp.Position.X, ehrp.Position.Y + aboveDistance, ehrp.Position.Z)
         local sideOffset = Vector3.new(math.random(-2,2)*1.5, 0, math.random(-2,2)*1.5)
         local safePos = basePos + sideOffset
         
         tweenToPosition(safePos)
         hrp.CFrame = CFrame.lookAt(safePos, ehrp.Position)
         
         -- Attack loop tercepat
         local lastAttack = 0
         while farming and target.Parent and target:FindFirstChildWhichIsA("Humanoid").Health > 0 do
            local dist = (hrp.Position - ehrp.Position).Magnitude
            if dist <= attackRange then
               local now = tick()
               if now - lastAttack >= attackDelay then
                  pcall(function()
                     local args = {
                        [1] = "Light",
                        [2] = {RootPart = ehrp}
                     }
                     RemoteAttack:FireServer(unpack(args))
                  end)
                  attackCount = attackCount + 1
                  lastAttack = now
               end
            end
            RunService.Heartbeat:Wait()
         end
      end
   end)
end

-- UI Controls
local MainSection = FarmTab:CreateSection("Farm Controls")

local ToggleFarm = FarmTab:CreateToggle({
   Name = "Auto Farm",
   CurrentValue = false,
   Callback = function(Value)
      farming = Value
      if Value then
         startFarm()
         Rayfield:Notify({
            Title = "Farm Started",
            Content = "Auto farm aktif – Tween super cepat",
            Duration = 3
         })
      else
         Rayfield:Notify({
            Title = "Farm Stopped",
            Content = "Auto farm dimatikan",
            Duration = 3
         })
      end
   end
})

local ToggleNoclip = FarmTab:CreateToggle({
   Name = "Noclip",
   CurrentValue = false,
   Callback = function(Value)
      noclipEnabled = Value
      setNoclip(Value)
   end
})

local AttackSlider = FarmTab:CreateSlider({
   Name = "Attack Delay (detik)",
   Range = {0.005, 0.1},
   Increment = 0.005,
   CurrentValue = 0.01,
   Callback = function(Value)
      attackDelay = Value
   end
})

local TweenSlider = FarmTab:CreateSlider({
   Name = "Tween Speed",
   Range = {300, 800},
   Increment = 50,
   CurrentValue = 500,
   Callback = function(Value)
      tweenSpeed = Value
   end
})

-- Regular Mobs Multi Select
local RegularSection = MobTab:CreateSection("Pilih Mob Biasa")

local RegularDropdown = MobTab:CreateDropdown({
   Name = "Multi Select Mob Biasa",
   Options = {},  -- Diisi setelah refresh
   CurrentOption = {},
   MultipleOptions = true,
   Flag = "RegularMobs",
   Callback = function(Options)
      selectedRegularMobs = {}
      for _, opt in ipairs(Options) do
         selectedRegularMobs[opt] = true
      end
   end
})

local RefreshMobs = MobTab:CreateButton({
   Name = "Refresh List Mob",
   Callback = function()
      scanEnemies()
      local options = {}
      for _, enemy in ipairs(validEnemies) do
         local name = enemy.Name
         if name \~= "Zangshi Hou Ren" and name \~= "Zangshi Hou Bing" then
            table.insert(options, name)
         end
      end
      RegularDropdown:Refresh(options, true)
      Rayfield:Notify({
         Title = "List Mob Diperbarui",
         Content = "Ditemukan " .. #options .. " mob biasa",
         Duration = 4
      })
   end
})

-- Boss Mobs Toggle
local BossSection = BossTab:CreateSection("Boss Khusus")

local ToggleRen = BossTab:CreateToggle({
   Name = "Farm Zangshi Hou Ren",
   CurrentValue = false,
   Callback = function(Value)
      selectedZangshiRen = Value
   end
})

local ToggleBing = BossTab:CreateToggle({
   Name = "Farm Zangshi Hou Bing",
   CurrentValue = false,
   Callback = function(Value)
      selectedZangshiBing = Value
   end
})

-- Stats
local StatsSection = FarmTab:CreateSection("Stats")
local AttackLabel = FarmTab:CreateLabel("Attacks: 0")

spawn(function()
   while true do
      wait(1)
      AttackLabel:Set("Attacks: " .. attackCount)
   end
end)

-- Anti-AFK loop
spawn(function()
   while true do
      if farming and tick() - lastAfkAction > math.random(120, 180) then
         doAntiKickAction()
         lastAfkAction = tick()
      end
      wait(60)
   end
end)

Rayfield:Notify({
   Title = "Soul Cultivation Farm Loaded",
   Content = "Tekan 'Refresh List Mob' untuk scan, pilih mob/boss, lalu toggle Auto Farm",
   Duration = 6
})
